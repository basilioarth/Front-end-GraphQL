# Resumo da Aula – Configurando Apollo Client + Zustand + Primeira Mutation (Register)

## 1. Instalação das dependências principais
```bash
npm install @apollo/client graphql
npm install zustand
```

## 2. Configuração do Apollo Client (`src/lib/apollo.ts`)
- Criado arquivo `src/lib/apollo.ts`
- Configurado `HttpLink` apontando para `http://localhost:4000/graphql`
- Instanciado `ApolloClient` com:
  - `HttpLink`
  - `InMemoryCache`
- Preparado espaço para futuros links:
  - **authLink** (injetar Bearer Token)
  - **errorLink** (tratar erros GraphQL + logout automático em 401/403)

## 3. Estrutura de pastas criada
```
src/
├── graphql/
│   └── mutations/register.ts     → GQL mutation de registro
├── lib/
│   └── apollo.ts                 → Apollo Client
├── stores/
│   └── auth.ts                   → Zustand store de autenticação
├── types/
│   └── index.ts                  → Interfaces compartilhadas (User, RegisterInput, etc.)
```

## 4. Mutation de Register (`src/graphql/mutations/register.ts`)
```graphql
mutation Register($data: RegisterInput!) {
  register(data: $data) {
    token
    refreshToken
    user {
      id
      name
      email
      createdAt
      updatedAt
    }
  }
}
```

## 5. Tipagens criadas (`src/types/index.ts`)
```ts
export interface User {
  id: string;
  name: string;
  email: string;
  role?: string;
  createdAt: string;
  updatedAt?: string;
}

export interface RegisterInput {
  name: string;
  email: string;
  password: string;
}
```

## 6. Store de autenticação com Zustand (`src/stores/auth.ts`)
- Usando `zustand` + middleware `persist` (armazena no localStorage)
- Estado inicial:
  - `user: null`
  - `token: null`
  - `isAuthenticated: false`
- Método `signup(name, email, password)`:
  - Chama `client.mutate<{ register: { token: string; user: User } }>`
  - Em caso de sucesso → salva `user`, `token`, seta `isAuthenticated: true`
  - Em caso de erro → `console.log` + retorna `false`
  - Retorna `true` quando cadastro é concluído com sucesso

## 7. Tipagem da resposta da mutation
```ts
type RegisterMutationData = {
  register: {
    token: string;
    refreshToken: string;
    user: User;
  };
};
```

## 8. Resumo do que já está funcionando
- Apollo Client configurado e conectado ao back-end
- Mutation `register` declarada e tipada
- Store de autenticação com Zustand criado e com método `signup` implementado
- Tudo já tipado com TypeScript (User, RegisterInput, resposta da mutation)

## Próximo passo (próxima aula)
- Conectar o formulário de Signup ao método `signup` do store
- Fazer o cadastro funcionar de verdade
- Salvar token no store/localStorage
- Redirecionar automaticamente para a home após registro bem-sucedido
- Implementar toast de sucesso/erro

Tudo pronto para a primeira mutation funcionar 100%! Bora testar o cadastro na próxima aula!